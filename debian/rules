#!/usr/bin/make -f
# -*- makefile -*-
# Sample debian/rules that uses debhelper.
# This file was originally written by Joey Hess and Craig Small.
# As a special exception, when this file is copied by dh-make into a
# dh-make output file, you may use that output file without restriction.
# This special exception was added by Craig Small in version 0.37 of dh-make.

# Uncomment this to turn on verbose mode.

export DH_VERBOSE=1

TCL_VERSION=8.5
package=libapache2-mod-rivet

export DH_OPTIONS

#%:
#	dh $@ 
clean: configure
	dh_testdir
	dh_testroot
	rm -f build-stamp configure-stamp
	$(MAKE) clean 
	dh_clean


build: configure build-stamp

build-stamp: configure-stamp
	dh_testdir
	$(MAKE)
	touch build-stamp

configure: configure-stamp

configure-stamp:
	dh_testdir
	chmod +x ./configure
	./configure --with-tcl=/usr/lib/tcl$(TCL_VERSION)/	\
		    --with-apache=/usr				\
		    --with-apxs=/usr/bin/apxs2			\
		    --with-tclsh=/usr/bin/tclsh$(TCL_VERSION)	\
		    --with-apache-version=2			\
		    --with-rivet-target-dir=/usr/lib/rivet2.0	\
		    --enable-version-display 
	touch configure-stamp

binary-indep: build libapache2-mod-rivet-doc

binary-arch: build libapache2-mod-rivet

binary: build binary-arch binary-indep

libapache2-mod-rivet: build
	dh_testdir -a 
	dh_testroot -a 
	dh_clean
	dh_installdirs -p$@
	dh_installchangelogs ChangeLog
	dh_installdocs -p$@
	dh_install -a
#	$(MAKE) install DESTDIR=$(CURDIR)/debian/$@
	dh_installexamples -a -p$@
	dh_auto_install -a -p$@ --destdir=$(CURDIR)/debian/$@
#	dh_install -a $(CURDIR)/debian/tmp $(CURDIR/debian/$(package)
	dh_install -a -p$@
#	dh_installmenu
#	dh_installdebconf
#	dh_installlogrotate
#	dh_installemacsen
#	dh_installpam
#	dh_installmime
#	dh_installinit
#	dh_installcron
#	dh_installinfo
	dh_installman -p$@
	dh_link -p$@
	dh_strip -p$@
	dh_compress -p$@
	dh_fixperms -p$@
	dh_makeshlibs -p$@
	dh_installdeb -p$@
	dh_shlibdeps -p$@
	dh_gencontrol -p$@
	dh_md5sums -p$@
	dh_builddeb -p$@ 

libapache2-mod-rivet-doc: build
	dh_testdir
#	( cd doc/; $(MAKE) docs )
	dh_testroot
	dh_installdirs -p$@
	dh_installchangelogs -p$@ ChangeLog
	dh_installdocs -p$@ 
	dh_installman -p$@
	dh_link -p$@
	dh_strip -p$@
	dh_compress -p$@
	dh_fixperms -p$@
	dh_makeshlibs -p$@
	dh_installdeb -p$@
	dh_shlibdeps -p$@
	dh_gencontrol -p$@
	dh_md5sums -p$@
	dh_builddeb -p$@ 

.PHONY: build build-stamp clean binary binary-indep binary-arch configure
