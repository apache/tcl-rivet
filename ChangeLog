2003-08-22  David N. Welton  <davidw@dedasys.com>

	* src/buildscripts/aardvark.tcl (aardvark::runbuildcommand):
	Rebuild only if file depended on is newer than the target, rather
	than >=.  This prevents some files from being remade if make is
	run again.

	* src/configure.tcl (configure::ProcessOptions): Added 'verbose'
	flag to configure.
	(configure::test): Exit on tcl failure in test procedures.
	(configure::assert): Added assert command.  Fail on error or 0.

2003-08-21  David N. Welton  <davidw@dedasys.com>

	* src/configure.in.tcl: Changed INC variable to use
	TCL_INCLUDE_SPEC.

	* INSTALL: Updated instructions.

	* src/configure.tcl (configure::parsetclconfig): We need access to
	previously parsed variables, so we do this in the ::configs
	namespace.

2003-08-20  David N. Welton  <davidw@dedasys.com>

	* src/buildscripts/aardvark.tcl (aardvark::getconfigs): Added new
	function to fetch the config info out of configs.tcl.

	* src/make.tcl: Removed debinstall target, because we can now
	accomplish the same thing by overriding configure options on
	make's command line.   Removed the configure-style code at the top
	of the file.

	* src/configure.in.tcl: Specify the variables to test for/create,
	as well as some command line options specific to Rivet.

	* src/configure.tcl: Added new configure-like system to obtain
	information about the environment where Rivet is being compiled.
	Running ./configure.tcl creates a file, configs.tcl, with the
	its findings.  make.tcl now uses those values as its defaults,
	unless they are overridden on make.tcl's command line.

2003-08-11  David N. Welton  <davidw@dedasys.com>

	* src/make.tcl: Added fileutils Tcl package to buildscripts, in
	order to utilize the 'install' command.

2003-08-05  David N. Welton  <davidw@dedasys.com>

	* contrib/rvt.vim: Added contributed vim mode for editing Rivet
	files.

	* contrib/two-mode-mode.el: Added emacs mode for editing Rivet
	files.

2003-07-22  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.ru.xml: Added lang=ru to article, so that markup like
	<note> produces the correct language.

	* doc/rivet.it.xml: Added Italian translation of Rivet docs by
	Fabio Zanotti <zendune@virgilio.it>.

2003-07-16  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Explain example script just a bit more clearly.

	* src/make.tcl: Fix up clean target.  Use MOD_SHLIB as target
	instead of explicit mod_rivet.so.

2003-07-08  David N. Welton  <davidw@dedasys.com>

	* src/buildscripts/findapxs.tcl: Added /usr/local/sbin as a place
	to check for apxs.  Thanks to Andy Doerr for pointing out that
	this is where it's kept on FreeBSD.

2003-07-07  David N. Welton  <davidw@dedasys.com>

	* doc/examples/upload.html: Added submit button to file upload
	example.

2003-07-05  David N. Welton  <davidw@dedasys.com>

	* src/rivetWWW.c (snprintf): Added snprintf define from Pat.

	* src/rivetParser.h: Added bit of defines for windows builds,
	declared some of the functions EXTERN's here.

	* src/rivetList.c: Make list commands created here 'static' - Pat.

	* src/rivetCrypt.c: Use ap_config.h to grab other header files we
	might need, like crypt.h.  This is not an ideal solution, because
	it adds a dependency we didn't have before.  Added change by Pat
	to conditionally compile or not the 'Rivet_Crypt' command.

	* src/rivet.h: Added EXTERN definitions for functions.

	* src/parserPkgInit.c (Rivetparser_Init): Added EXTERN decleration
	for win builds.

	* win/rules.vc: New file: include file for Microsoft makefile.

	* win/rivet.dsp: New file: Microsoft Developer Studio Project
	File.

	* win/nmakehlp.c: New file: helper for windows building.

	* win/makefile.vc: New file: makefile for windows.  All from Pat
	Thoyts <patthoyts@users.sourceforge.net>.

	* doc/examples/vars.html: Use a table to make the form look nicer.

	* doc/examples/vars.rvt: Now we display some results.

2003-07-01  David N. Welton  <davidw@dedasys.com>

	* src/rivetCore.c (Rivet_Upload): Pass the correct element of objv
	to TclWeb_UploadSave.

	* tests/uploadsave.rvt: New file to test 'upload save'.

	* tests/upload.test: New test for 'upload save'.

2003-06-30  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_ParseExecFile): Use Tcl_FSStat instead of
	Tcl_Stat.

	* src/rivetCore.c (Rivet_Parse): Use Tcl_FSStat instead of
	Tcl_Stat.

2003-06-29  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Add IRC reference to the help section of the
	  manual.

2003-06-23  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.ru.xml: Updated Russian version to indicate which
	version of the original it was based on.

	* doc/rivet.xml: Added version string to English version.

2003-06-14  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Added CVS Id tag.

	* doc/rivet.ru.xml: Added comment to indicate the version of
	rivet.xml that the Russian translation is based on.

2003-06-12  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_ParseExecFile): Rework checks for
	.htaccess file changes.  This code was causing an obscure bug
	where a file would be in the cache twice, thus causing crashes.

	* Moved russian translation around again.

	* src/TclWebapache.c (TclWeb_GetEnvVars): Use TCL_NAMESPACE_ONLY
	here and in TclWeb_GetHeaderVars in order to set the variable in
	the correct place.

	* src/make.tcl: Added changes to build Russian documentation.

	* doc/rivet.xml: Added link to Russian translation.

	* doc/rivet.ru_UTF.xml: Added link back to English version.

2003-06-10  David N. Welton  <davidw@dedasys.com>

	* doc/rivet_utf_ru.xml: Added Russian translation of documentation
	by Dmitry Zuryanovich.

2003-06-09  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Cleaned up docs about fetching the httpd sources.

2003-05-26  David N. Welton  <davidw@dedasys.com>

	* src/rivetCore.c (Rivet_Headers): Change error message to better
	reflect that there is only one argument to 'headers numeric'.
	Thanks to "Dmitry Zuryanovich".

	* src/mod_rivet.c (Rivet_ParseExecFile): Updated
	Rivet_GetRivetFile and Rivet_GetTclFile to use the right
	arguments.

2003-05-24  David N. Welton  <davidw@dedasys.com>

	* rivet/packages/tclrivet/tclrivet.tcl: Added commands that need
	to be filled in.

	* tests/runtests.tcl: Use apachetest::need_modules.

	* tests/apachetest/apachetest.tcl (apachetest::need_modules): New
	proc, utilized to tell the test suite which apache modules are
	needed.

2003-05-23  David N. Welton  <davidw@dedasys.com>

	* src/buildscripts/aardvark.test: Do a version check on gcc.  We
	used that for the tests, so we might as well be sure we're using
	the same version.

	* src/make.tcl: Use buildscripts.tcl to load up all the other
	scripts we need.  Add PARSER_SHLIB as a dependency for the shared
	build.

	* src/buildscripts/aardvark.test: Updated aardvark tests to
	current GCC.

	* src/buildscripts/buildscripts.tcl: New file: use this file to
	load up all the other scripts.

	* src/buildscripts/findconfig.tcl: Moved all the functionality
	into parsetclConfig.tcl.

	* src/buildscripts/aardvark.tcl: Just source the graph.tcl file
	directly instead of dealing with packages.  Thanks to Pat Thoyts.

2003-05-22  David N. Welton  <davidw@dedasys.com>

	* src/rivetParser.c (Rivet_GetRivetFile): API Change: instead of
	taking a TclWebRequest argument, we just give this function a
	Tcl_Interp, which makes it easier to seperate this code from
	Rivet.

	* src/mod_rivet.h: STARTING_SEQUENCE and ENDING_SEQUENCE moved to
	rivetParser.h, in order to make that file independant of
	mod_rivet.h.

	* src/make.tcl: Use slightly more descriptive variable names.  Add
	code to compile librivetparser.so.

	* src/parserPkgInit.c: New file.  Provides a Tcl extension to the
	Tcl parser, so that regular (not running under Apache) scripts can
	access it.

	* doc/html/rivet.css: Updated a few stylesheet properties to make
	the docs look a bit classier.

2003-05-21  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xsl: Switch on parameter to use images in HTML output
	from docbook.

	* doc/rivet.xml: Added c.l.t. newsgroup to resources section.

2003-05-20  David N. Welton  <davidw@dedasys.com>

	* doc/html/rivet.css: Added CSS file.

	* src/make.tcl: Added parameter to xsltproc to link the html
	output to a CSS file.

2003-05-14  David N. Welton  <davidw@dedasys.com>

	* src/make.tcl: Added PKGINDEX to the list of dependencies for
	rolling a distribution.  Updated STATUS file.

	* rivet/packages/commserver/commserver.tcl: Added commserver
	package as one potential IPC method.

	* src/make.tcl: Target ../VERSION node correctly.
	New target $PKGINDEX to automatically generate a top-level (which
	is where Tcl searches) package index for all the sub-packages in
	the Rivet distribution.

	* src/buildscripts/aardvark.tcl (aardvark::runbuildcommand): A few
	stylistic changes: [ cmd ] -> [cmd].

2003-05-13  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Added a few options - numeric and add to the
	header documentation.  Removed 'setcookie', which has been
	replaced by the 'cookie' command.

	* src/make.tcl: Pass [info nameofexecutable] to mod_rivet.c
	compilation, in order to make Rivet aware of the location of
	tclsh.

	* src/mod_rivet.c (Rivet_InitTclStuff): Use name of tclsh
	executable passed in via the build script.  This isn't really the
	name of the executable Rivet is part of (Apache), but I think this
	is more useful.

2003-05-11  David N. Welton  <davidw@dedasys.com>

	* src/apache_request.c: Updated to the latest from the httpd-apreq
	package.

2003-04-07  David N. Welton  <davidw@dedasys.com>

	* src/make.tcl: Make sure that auto_path gets extra stuff at the
 	  beginning, so as not to create problems when using it to fetch
	  the prefix.

	* VERSION: Bump point number for new release.

	* src/make.tcl: Use package require to load aardvark.

	* src/buildscripts/graph.tcl: This file should provide the
	  'struct' package.

2003-03-30  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Fixed example configuration directive.

2003-03-27  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c (TclWeb_UploadData): Comment out unused alloc.

	* src/rivetWWW.c (Rivet_UnescapeStringCmd): Free memory allocated
	with Tcl_Alloc.
	(Rivet_EscapeStringCmd): Free memory allocated with Tcl_Alloc.
	(Rivet_EscapeSgmlCharsCmd): Free memory allocated with Tcl_Alloc.
	(Rivet_EscapeShellCommandCmd): Free memory allocated with Tcl_Alloc.

	* src/rivetCrypt.c (Rivet_DecryptCmd): Free memory allocated with
	Tcl_Alloc.
	(Rivet_EncryptCmd): Free memory allocated with Tcl_Alloc.

2003-03-26  David N. Welton  <davidw@dedasys.com>

	* Remove index.html and help.html.

	* rivet/pkgIndex.tcl: Added index file for RivetTcl package -
	i.e. init.tcl.

2003-03-25  David N. Welton  <davidw@dedasys.com>

	* src/rivetPkgInit.c (Rivet_Init): Bump version number to 1.1.

	* src/mod_rivet.c (Rivet_InitTclStuff): Use Tcl_PkgRequire to load
	Rivet's init.tcl.

	* src/make.tcl: Use Tcl file location instead of Apache-based file
	location, in order to use Tcl_PkgRequire to load Rivet's init.tcl.

	* rivet/init.tcl: Provide 'RivetTcl' package.
	(init): Use [info script] instead of server(RIVET_DIR) variable.

	* src/make.tcl: Add a debinstall target as a temporary way to
	build .deb files.

	* debian/copyright: Added copyright file for debian.

	* debian/dirs: Added dirs file that lists directories used by
	Rivet on Debian.

	* debian/control: Added debian/control file with information about
	Rivet for the debian package.

	* debian/changelog: Added debian changelog file to track versions
	of the debian package.

	* debian/rules: Use 'rules' file from mod_dtcl.

2003-03-14  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_AppendToScript): Don't append
	Before/After/Error scripts.  Just override them.
	(Rivet_UserConf): Switch back to usig Rivet_AppendToScript.
	(Rivet_SetScript): Change Rivet_AppendToScript to Rivet_SetScript
	to reflect the fact that it doesn't always append - specifically,
	in After/Before/Error scripts.

	* doc/rivet.xml: Use eyebrowse link instead of apachelabs for
	mailing list.

2003-03-13  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.h: Backed out extra entries in rivet_server_conf -
	they aren't necessary, as the overrides are taken care of for us.
	The only things we really need are 1) to use the flag
	user_scripts_updated to recompile scripts when UserConf variables
	have changed 2) to not append to existing scripts, but instead
	create new ones.

2003-03-12  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_UserConf): Set user_scripts_updated flag.
	(Rivet_ParseExecFile): Check and clear flag.

	* src/mod_rivet.h: Added user_scripts_updated flag to signal that
	UserConf options have been set.  This means that we need to
	recompile the script.

2003-03-01  David N. Welton  <davidw@dedasys.com>

	* debian/debian.tcl: Helper file for generating .debs.

2003-02-28  David N. Welton  <davidw@dedasys.com>

	* src/Makefile (all): Clean out Makefile - force use of make.tcl.

	* src/buildscripts/aardvark.tcl (aardvark::runbuildcommand): Use
	'w' for shell command pipe, in order to not get broken pipes with
	commands that output something to stdout (such as tcl scripts!).

2003-02-21  David N. Welton  <davidw@dedasys.com>

	* tests/config.test: Test to see if Rivet picks up changes in
	".htaccess" files.

	* tests/README: Add descriptions of the various tests.

	* src/buildscripts/aardvark.tcl (aardvark::Nodes): Add command to
	return list of all nodes.

	* doc/rivet.xml: Add some information on the precedence of the
	different Conf options.  Change information about DirConf - it
	isn't allowed in .htaccess files.

2003-02-19  David N. Welton  <davidw@dedasys.com>

	* src/buildscripts/aardvark.test: Add test script and files for
	aardvark system.

	* src/buildscripts/graph.tcl: Include latest 'graph.tcl' from
	upstream.

	* src/make.tcl: We no longer force 'tcl' and 'sh' to take only one
	argument.  In the case where we aren't forcing evaluation later
	with {}, this is nicer looking, as we don't have to quote
	everything with "".

2003-02-12  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c: Mirror Craig Huckabee's mod_dtcl.c changes:

	- Use TCL_DECLARE_MUTEX to create the mutex, and change the mutex
	  lock/unlock calls.

	- Remove the 'load only once' stuff from TclInitStuff.

	- InitTclStuff can now only be called from Child Init.

2003-01-17  David N. Welton  <davidw@dedasys.com>

	* Added logos.

2003-01-08  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_ChildInit): Patch from Karl Lehenbauer to
	print out errorInfo upon ChildInit failure.

2003-01-07  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c (TclWeb_UploadData): Fix from Holger Zeinert
	that makes file uploads work on windows.

2002-12-30  David N. Welton  <davidw@dedasys.com>

	* doc/examples/upload.html: Changed .ttml to .rvt - thanks to
	Holger Zeinert for catching this.

2002-12-18  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Noted the var_qs/var_post changes in the
	documentation.

2002-12-17  David N. Welton  <davidw@dedasys.com>

	* tests/post.test:
	* tests/post.rvt:
	* tests/get.test:
	* tests/get.rvt: Added tests for David Brancato's var_qs and
	var_post improvements.

	* src/TclWebapache.c: Made "ugly" for loops into while loops.
	Created macro to set up loop parameters correctly.

2002-12-14  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c: Redid indendation.

	* src/rivetCore.c: Implemented Tcl commands (via objv[0]) to
	retrieve variables from different, specified sources (query
	string, POST). (David Brancato).

	* src/mod_rivet.h: Added defines for variable sources. (David
	Brancato).

	* src/apache_request.c: Added functions to get query and post
	params. (David Brancato).

	* src/TclWebapache.c: Implemented TclWeb.h API change. (David
	Brancato).

	* src/TclWeb.h: Changed API to include a source option in order to
	indicate the origin (query string, POST) of a variable.  (David
	Brancato).

2002-12-13  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_InitTclStuff): Apache actually loads all
	the modules twice, just to see if it  can. This is a pain,
	because things don't seem to get  completely cleaned up on the
	Tcl side. So this little hack  should make us *really* load only
	the second time around.

2002-12-10  David N. Welton  <davidw@dedasys.com>

	* table.png: Transformed table.png so that it ought to display
	correctly on older(?) browsers.  Thanks to Elchonon Edelson for
	his help.

2002-12-09  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_SendContent): Switched from EvalObj to
	EvalObjEx.
	(Rivet_SendContent): EXPERIMENTAL: added Mutex locks on
	SendContent, in order to keep windows safe.  This needs testing
	out!

2002-12-04  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c (TclWeb_GetEnvVars): Put DecrRefCount back in
	- must have taken it out by mistake while hunting a previous
	memory leak.

2002-11-23  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_SendContent): Set up information for
	[info script] by using r->filename.

2002-11-19  David N. Welton  <davidw@dedasys.com>

	* doc/examples/table.rvt: Fixed up format operation to make nicer
	tables.

2002-11-18  David N. Welton  <davidw@dedasys.com>

	* cvsversion.tcl (main): Added catch to make sure that VERSION has
	something in it and isn't.

2002-11-09  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Make docs reflect behavior of 'var get foobar'
	when foobar doesn't exist - "" is returned.

	* tests/apachetest/apachetest.tcl: Updates to testing utility
	procedures.

2002-11-04  David N. Welton  <davidw@dedasys.com>

	* tests/get.test: Backed out changes to 'var get': no longer
	throws an error if the variable does not exist, but instead
	returns "".  Use 'var exists' to see if it really exists or not.

	* src/mod_rivet.c (Rivet_ChildExit): Add call to Tcl_Finalize.
	This still needs more investigation.

	* tests/upload.test: Added proper end boundary to upload test.

	* src/apache_*: New apache request code from upstream.

2002-10-29  David N. Welton  <davidw@dedasys.com>

	* src/rivetWWW.c (Rivet_EscapeStringCmd): Eliminate warning on
	Solaris by casting a char to an int.

2002-10-28  David N. Welton  <davidw@dedasys.com>

	* src/rivetCore.c (Rivet_Include): Changed Tcl_Channel name to
	tclstdout to avoid any conflicts with the real stdout.

2002-10-23  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xsl: Use <pre> tag for source code examples.

2002-10-22  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c (TclWeb_StringToUtf): One more CONST84 - now
	we pass the tests!

2002-10-21  David N. Welton  <davidw@dedasys.com>

	* src/*.c: "CONST"ification.  See http://mini.net/tcl/3669 for
	more information.

	* src/: Minor build script updates.

2002-10-20  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: "make" needed to be "make.tcl".  Thanks to Makoto
	SATOH.

2002-10-18  David N. Welton  <davidw@dedasys.com>

	* tests/get.test: Added tests for new "var get" behavior.

	* doc/rivet.xml: Documented new "var get" behavior.

	* src/rivetCore.c (Rivet_Var): Added ?default? option to "var
	get".

	* doc/examples/: Added examples for XML document.

	* doc/rivet.xml: Several examples of how to use Rivet.

2002-10-17  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Added Entities to deal with included files.  This
	makes it easier to correctly format the source code that is to be
	included.

2002-10-09  David N. Welton  <davidw@dedasys.com>

	* src/buildscripts/findapxs.tcl: Added /usr/sbin/ at the request
	of David Brancato, who notes that Redhat often locates apxs there.

2002-10-02  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Added 'Introduction' section.

2002-09-29  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Reworked several elements to better utilize
	docbook.

	* doc/rivet.xsl: Major reworking of several elements, including
	group and arg.  Added lots of style changes.

	* src/make.tcl: Add commands and dependencies to build extensions
	documents without chunks, and the main Rivet docs in chunks
	(seperate HTML files are output).

	* doc/rivet.xml: Updated docs to reflect new Apache directives.

2002-09-27  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_InitTclStuff): Change default CacheSize
	to MaxRequestsPerChild / 5, which should still be plenty, but will
	waste less space.

	* src/rivetCore.c (Rivet_Include): "include" command now saves
	channel encoding/translation, outputs the included file to stdout
	with binary translation/encoding, and then resets the original
	settings.  Fixes problem with EUC-JP characters in included
	files.  Thanks to Makoto SATOH for his help in finding this.

	* tests/lang.test: Added file to test LANG setting in server, to
	check character encodings.

	* tests/parse.test: Added EUC-JP characters to test that they come
	through ok.

	* tests/include.test: Added EUC-JP characters to test that they come
	through ok.

2002-09-11  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c (TclWeb_InitEnvVars): Don't do an
	ap_clear_table on the environmental variables.  The include module
	no longer does this, and neither does PHP, so I guess it's safe to
	remove, and it's useful for users of modules like mod_uniqe_id.

2002-09-08  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c: Fix up ObjSetVar2 use.

	* src/mod_rivet.c: Fix up another instance of ObjSetVar2.

2002-09-07  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_PropagatePerDirConfArrays): Do the right
	tricks with IncrRefCount and DecrRefCount to stop the leak.

2002-08-03  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_AppendToScript): Changed before, after,
	and error scripts back to plain old ascii, in order to plug a
	memory leak.

	* src/mod_rivet.h: New macro: FILEDEBUGINFO off by default.
	Useful for debugging the order of functions called.

2002-07-28  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xsl: Updated rivet.xsl from Websh's xsl.

2002-07-21  David N. Welton  <davidw@dedasys.com>

	* doc/rivet.xml: Several new sections.  We now have most of what
	is in the HTML documents.

2002-07-19  David N. Welton  <davidw@dedasys.com>

	* src/buildscripts/aardvark.tcl (aardvark::runbuildcommand):
	Attempt to use 'open' to execute shell commands, in order to both
	catch the output as well as the return code.

	* doc/rivet.xml: New file.  Removed directives.xml in favor of
	this, which we will use to build individual HTML files and other
	forms of documentation.

2002-07-18  David N. Welton  <davidw@dedasys.com>

	* src/rivetCore.c (Rivet_Upload): Changed format of 'upload'
	command to be more like 'var'.  Changed relevant tests.

2002-07-14  David N. Welton  <davidw@dedasys.com>

	* doc/directives.xml: New file - XML version of directives.html.

2002-07-12  David N. Welton  <davidw@dedasys.com>

	* src/buildscripts/aardvark.tcl (aardvark::runbuildcommand):
	Updated functionality to hopefully better handle errors, warnings,
	and output.

	* src/make.tcl: Created a 'dist' target which rolls a tarball.

2002-07-11  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c (TclWeb_GetHeaderVars): New function to get
	client headers, which are now seperate from environmental
	variables.

2002-06-18  David N. Welton  <davidw@dedasys.com>

	* cvsversion.tcl: Added tool to manage version numbers based on
	CVS changes.

2002-06-17  David N. Welton  <davidw@dedasys.com>

	* src/make.tcl: Updated build scripts to build the HTML
	documentation from XML files.

	* src/buildscripts/aardvark.tcl: Changed commands to 'sh' for
	shell commands and 'tcl' for Tcl commands.

2002-06-10  David N. Welton  <davidw@dedasys.com>

	* doc/packages/dio/dio.xml: Further updates.

2002-06-08  David N. Welton  <davidw@dedasys.com>

	* doc/packages/dio/dio.xml: Finished up adding material to
	dio.xml.

2002-06-06  David N. Welton  <davidw@dedasys.com>

	* doc/packages/dio/dio.xml: Initial commit of (incomplete) docbook
	documentation.

	* doc/packages/dio/rivet.xsl: Added XSL file for docbook
	documentation.

2002-05-03  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c (TclWeb_GetVarAsList): Added check to length
	to make sure we fully compare the two variables.  Idem for
	TclWeb_VarExists.

2002-04-19  Damon J. Courtney <damon@unreality.com>
	* src/TclWebapache.c
	    Added 'TclWeb_GetVirtualFile' command which returns the full
	    path to a virtual file.

	* src/rivetCore.c
	    Added command 'virtual_filename' to return the full path to a
	    virtual file.

	    Added -virtual option to include and parse commands to enable
	    them to parse a virtual file which is relative to the webserver.

2002-03-26  Damon J. Courtney <damon@unreality.com>

	* rivet/packages/form
	    Added a new package for handling forms in Rivet.

2002-03-26  Damon J. Courtney <damon@unreality.com>

	* src/TclWebapache.c
	    Moved the setting of include variables from LoadEnv to the
	    InitEnv command.  This will allow us to retrieve these variables
	    via the env command as well as load_env.

2002-03-21  Damon J. Courtney <damon@unreality.com>

	* src/TclWebapache.c
	* src/TclWeb.h
	    Added new command 'TclWeb_HeaderAdd'.

	* src/rivetCore.c
	    Added 'add' option to headers command to add a header instead
	    of just setting over one.

	* rivet/rivet-tcl/cookie.tcl
	    The cookie command adds a header instead of setting one.  This
	    allows multiple cookies in a single page.

2002-03-21  Damon J. Courtney <damon@unreality.com>

	* src/TclWebapache.c
	    If the header being set is Set-Cookie, we add it to the table
	    instead of overwriting it.  This allows us to set more than
	    one cookie per page, which is legal to all browsers.

2002-03-19  Damon J. Courtney <damon@unreality.com>

	* rivet/init.tcl
	    Appended packages-local to the auto_path.  This will be a great
	    place for people to place local packages that we won't mess with.

2002-03-18  David N. Welton  <davidw@dedasys.com>

	* tests/apachetest/apachetest.tcl: Added TclX to requirements.
	Damn.

2002-03-16  David N. Welton  <davidw@dedasys.com>

	* tests/runtests.tcl: Updated to run with apachetest, eliminating
	makeconf.tcl, and moving template.conf.tcl to the apachetest
	directory.

	* tests/apachetest/apachetest.tcl: New file, grouping together
	the test functions in one place, and in a namespace.

2002-03-15  David N. Welton  <davidw@dedasys.com>

	* tests/config.test: Added some new, automatically generated
	tests.

	* src/mod_rivet.c (Rivet_MergeDirConfigVars): Make sure that both
	arguments to overlay_tables exist!

	* src/mod_rivet.h: Add a default error script.

	* src/TclWebapache.c (TclWeb_GetEnvVars): DecrRef for the name of
	the environment variable.

	* rivet/rivet-tcl/cookie.tcl (make_cookie_attributes): Add an
	interface to add the 'expire' field directly.
	(cookie): "Set-Cookie" is uppercase for both words.

2002-03-15  Damon J. Courtney <damon@unreality.com>

	* src/apache_cookie.c
	* src/apache_cookie.h
	    Removed in favor of doing cookies through a Tcl interface.

	* src/channel.c
	* src/channel.h
	    Renamed to rivetChannel.c and rivetChannel.h

	* src/rivetCore.c
	* src/TclWebapache.c
	    Removed references to Apache cookie functions.

2002-03-14  Damon J. Courtney <damon@unreality.com>

	* src/TclWebapache.c
	    Added a routine to setup the environment variables and mark
	    that they have been set.  This will save us from having to
	    reload them all the time.  Once they're loaded, they don't
	    load again.

	* rivet/rivet-tcl/cookie.tcl
	    Added a new 'cookie' command for setting and getting cookies.

	* rivet/rivet-tcl/import_keyvalue_pairs.tcl
	    Added a command to import keyvalue pairs from arguments.

	* rivet/rivet-tcl/load_cookies.tcl
	    Made load_cookies use the env command to get the one variable
	    it needs instead of load_env, which gets a bunch it doesn't
	    need.

	* rivet/rivet-tcl/debug.tcl
	    Made debug use the env and import_keyvalue_pairs commands.

2002-03-13  Damon J. Courtney <damon@unreality.com>

	* src/mod_rivet.c
	    Cleaned up the error handling a little.  There was a really nasty
	    bug that if the ErrorScript was defined, it wouldn't actually
	    error out.  This had something to do with the header output and
	    flush being before the ErrorScript was executed.

	* rivet/init.tcl
	    Changed the default error handler to a Tcl proc.

2002-03-13  Damon J. Courtney <damon@unreality.com>
	* src/make.tcl
	* src/TclWebapache.c
	    Cleaned up the remainder of the compiler warnings.
	    Rivet should build cleanly without warnings now.

2002-03-13  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (Rivet_PropagatePerDirConfArrays): Clean up
	arrayName object after we're done with it.

	* src/TclWebapache.c (TclWeb_GetVar): Make sure to compare all of
	the variable key.

	* src/mod_rivet.c (Rivet_InitTclStuff): Moved creation of "rivet"
	AssocData here.

2002-03-12  Damon J. Courtney <damon@unreality.com>

	* src/mod_rivet.c
	* src/mod_rivet.h
	* src/rivetParser.c
	* src/rivetCore.c
	* src/TclWebapache.c
	    Cleaned up a lot of memory leaks.  Still working on finding more.

2002-03-12  David N. Welton  <davidw@dedasys.com>

	* tests/makeurl.test: New test.

	* src/TclWebapache.c (TclWeb_MakeURL): Use Tcl_SetStringObj
	instead of creating a new object.

	* src/rivetCore.c (Rivet_MakeURL): Pass already created object to
	TclWeb_MakeURL.

2002-03-11  Damon J. Courtney <damon@unreality.com>

	* src/TclWeb.h
	    Added declaration for TclWeb_GetEnvVar.

	* src/TclWebapache.c
	    Added command TclWeb_GetEnvVar.  Gets a single environment
	    variable.

	* src/mod_rivet.c
	    Added some extra stuff to the default error functions.
	    If the error_script fails, we output the failure.

	* src/rivetCore.c
	    Added Tcl 'env' command to get a single environment variable.

	* src/make.tcl
	* src/buildscripts/aardvark.tcl
	* src/buildscripts/graph.tcl
	    Cleaning up a bug with the struct package.

2002-03-10  Damon J. Courtney <damon@unreality.com>

	* src/mod_rivet.c
	    The Scripts output to the UserConf arrays now properly display
	    the scripts in their entirety.

	    Cleaned up the handling of directory configuration merging.

	    Fixed a bug where Rivet_GetRivetFile was stomping the BeforeScript.

2002-02-23  David N. Welton  <davidw@dedasys.com>

	* tests/upload.test: Added upload test.

	* src/TclWebapache.c: Added functions: TclWeb_PrepareUpload,
	TclWeb_UploadChannel, TclWeb_UploadSave, TclWeb_UploadData,
	TclWeb_UploadSize, TclWeb_UploadType, TclWeb_UploadFilename,
	TclWeb_UploadNames.

	* src/rivetCore.c (Rivet_Upload): Offloaded functionality to
	TclWebApache.c.

2002-02-17  Damon J. Courtney <damon@unreality.com>

	* src/make.tcl
	    Added a script to look around a little more for Apache's apxs tool.
	    If we can't find it, we output an error message to the user.

	* src/buildscripts/findapxs.tcl
	    Added to repository.

2002-02-12  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c: Added some INLINE's.

	* src/mod_rivet.c (Rivet_ParseExecFile): Tweaking of parameters to
	enable the modification stated below.

	* src/rivetCore.c (Rivet_Parse): Removed 'rsc' from this
	function.

2002-02-07  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c (TclWebMakeURL): New command, extracted out
	of rivetCore.c.

2002-02-01  David N. Welton  <davidw@dedasys.com>

	* src/rivetCore.c: Deleted rivet_info command.

	* src/TclWebapache.c (TclWeb_GetEnvVars): Added RIVET_CACHE_FREE
	# and RIVET_CACHE_SIZE as environmental variables.

2002-01-29  David N. Welton  <davidw@dedasys.com>

	* doc/help.html: Updated mailing list archive location.

2002-01-28  David N. Welton  <davidw@dedasys.com>

	* src/rivetCore.c (Rivet_Include): Get channel via Tcl_GetChannel
	instead of through the apache config structure.

2002-01-27  David N. Welton  <davidw@dedasys.com>

	* tests/parse.test: Added test for 'parse' command.

	* src/mod_rivet.c (Rivet_ParseExecFile): Moved the addition of
	before and after scripts to this file, so that GetRivetFile is
	independant of any Apache specific code.

	* src/rivetParser.c, src/rivetParser.h: New files, which replace
	parser.c and parser.h.
	(Rivet_GetRivetFile): Moved from mod_rivet.c.  Now capable of
	operating independantly of mod_rivet.  Use Tcl file functions
	instead of Apache functions.
	(Rivet_Parser): Parser now operates on a Tcl_Obj input buffer.

	* src/mod_rivet.h: Moved content_sent to TclWebRequest in TclWeb.h

2002-01-26  David N. Welton  <davidw@dedasys.com>

	* tests/binary.test: Added test file for binary file handling.

	* src/mod_rivet.c (Rivet_SendContent): Moved 'header_only' option
	so that the request is set up and we don't segfault.
	(Rivet_GetRivetFile): changed puts to puts -nonewline, so as to
	not add spurious newlines.

	* src/rivetCore.c (Rivet_Include): Simplified code some, with '-1'
	argument to Tcl_ReadChars.  Eliminated "lf" -translation option.

2002-01-24  David N. Welton  <davidw@dedasys.com>

	* tests/include.test: Added test for 'include' command.

2002-01-22  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c, src/channel.c, src/rivetCore.c: Switched to
	TclWeb functions for error, headers.

	* src/mod_rivet.h: Moved headers_set and headers_printed out of
	the rivet_server_conf struct and into the TclWebRequest struct.

	* src/TclWebapache.c: Moved PrintHeaders, PrintError and
	SetHeaderType from mod_rivet.c.

	* src/TclWeb.h: Added ER1, ER2 and DEFAULT_HEADER_TYPE here.

	* tests/get.test: Added some tests related to [var *].

	* tests/post.test: Added some tests related to [var *].

	* src/rivetList.c (Rivet_LassignArrayObjCmd): Use -1 instead of
	NULL when doing NewStringObj.

	* src/rivetCrypt.c: Added header file.

	* src/make.tcl: Added slightly nicer apxs handling.

	* src/mod_rivet.c: Moved StringToUtf to TclWeb.

	* src/mod_rivet.h: Removed StringToUtf macro.

	* src/TclWebapache.c: Lots of bug fixes and corrections.

	* src/rivetCore.c (Rivet_LoadEnv): Switched to TclWeb API.
	(Rivet_LoadCookies): Switched to TclWeb API.
	(Rivet_Var): Switched to TclWeb API.

2002-01-19  Damon J. Courtney <damon@unreality.com>

	* src/rivetCore.c
	    Moved authorization from its own array into the env array as
	    HTTP_USER and HTTP_PASS.

	    Added an abort_page command which halts the sending of a request.

2002-01-19  David N. Welton  <davidw@dedasys.com>

	* src/TclWebapache.c: Added individual functions for CGI variable
	access.  Much simpler than trying to devise a data structure to
	pass them around with.

	* src/rivetCore.c (Rivet_LoadEnv): Roll back authorization
	information command.

2002-01-18  David N. Welton  <davidw@dedasys.com>

	* src/rivetCore.c (Rivet_LoadAuth): New command to load
	authorization information in its own array.

	* src/TclWebcgi.c: New file for stand-alone implementations of
	common web API.

	* src/TclWebapache.c: New file for apache-based implementations of
	web API.

	* src/TclWeb.c: Common code for TclWeb API.

	* src/TclWeb.h: TclWeb web interaction API.

2002-01-11  Damon J. Courtney <damon@unreality.com>

	* src/make.tcl
	    Updated some of the make nodes.

	    librivet.so now gets copied into the rivet package directory.


	* src/mod_rivet.c
	    Changed Rivet_Init to Rivet_InitCore to fix bug.

	    All Script directives now append to each other instead of
	    overwriting the last directive.  Directory directives still
	    override in standard fashion though.

	* rivet/packages/rivet
	    Added as the default package of Rivet commands in C.

2002-01-10  Damon J. Courtney <damon@unreality.com>
	* src/rivet.h
	    Added macro 'TCL_CMD_HEADER'.  Prints the default command header
	    for Tcl commands in Rivet.

	    Added macro 'TCL_OBJ_CMD'.  Prints the default object command
	    creation for Tcl commands in Rivet.

	* src/rivetInit.c
	    Renamed to rivetPkgInit.c

	* src/rivetCrypt.c
	    Added.  Contains commands for encryption and decryption.
		encrypt
		decrypt
		crypt

	* src/rivetWWW.c
	    Added.  Contains commands for the world wide web.
		escape_string
		unescape_string
		escape_sgml_chars
		escape_shell_command

	* src/rivetList.c
	    Added the following commands:
		comma_split
		comma_join
		lassign_array

	* src/make.tcl
	    Moved all of the Rivet Tcl commands into their own library
	    called librivet.  This will be automatically loaded into Rivet
	    as the default configuration.  Anyone who wants can take it
	    out if they choose.

2002-01-10  David N. Welton  <davidw@dedasys.com>

	* tests/template.conf.tcl: Re-add srm.conf and access.conf - if
	they aren't present, it tries to grab the ones from /etc/ - not
	what we want.

2002-01-09  Damon J. Courtney <damon@unreality.com>
	* src/tcl_commands.c
	    Renamed to rivetCore.c

	* src/tcl_commands.h
	    Removed.

	* src/rivet.h
	    Added as the default header file for Rivet Tcl commands.

	* src/rivetList.c
	    Added.  Only contains 'lremove' right now.

	* src/rivetInit.c
	    Added.  Contains the Tcl initialization routine for Rivet's Tcl
	    commands.

	* src/make.tcl
	    Added rivetCore.c, rivetList.c and rivetInit.c to the make.

2002-01-08  Damon J. Courtney <damon@unreality.com>
	* src/mod_rivet.h
	    Added RIVET_NEW_CONF macro to create a new rivet_server_conf.

	* src/mod_rivet.c
	    Added Rivet_MergeDirConfig to merge directory configurations.

	    Fixed bug where RivetDirConf was giving erroneous information.

2002-01-08  Damon J. Courtney <damon@unreality.com>

	* tests/makeconf.tcl
	    Went ahead and copied over the entire rivet directory.

	* tests/rivet.test
	    Changed the default port to 8081.

	* tests/template.conf.tcl
	    Changed the default port to 8081.
	    Removed access.conf and srm.conf.

2002-01-08  David N. Welton  <davidw@dedasys.com>

	* tests/makeconf.tcl (makeconf): Added a command to copy over the
	    init.tcl file to the testing directory.  It would probably be
	    best to copy the whole directory, though.

2002-01-08  Damon J. Courtney <damon@unreality.com>

	* src/channel.c
	    Just a text change.

	* src/make.tcl
	    Added a command to install that will copy the contents of the
	    rivet/ directory into Apache's install location.

	* src/mod_rivet.h
	    Removed some superfluous code and deprecated options.

	* src/mod_rivet.c
	    Finished renaming the rest of the remaining commands into the
	    standard Rivet_ naming scheme.  This will prevent any further
	    interferance with other modules.

	    Renamed namespacePrologue to request_init and re-coded the
	    namespace initialization code in Tcl.

	    Removed leftover references to the ::request::UPLOAD array.

	    Added an array called 'server' to the global namespace which
	    briefly contains important information about Apache and Rivet.

	    Propagated RivetServerConf, RivetDirConf and RivetUserConf arrays
	    at the tcl level.

	    Gave RivetUserConf the ability to set BeforeScript, AfterScript
	    and ErrorScript.

	* src/tcl_commands.c
	    Updated makeurl to use Tcl objects instead of the old Tcl_SetResult
	    command.

	* rivet/
	    Added a rivet/ directory of Tcl code.

	    Added init.tcl to rivet/.  This file contains initialization code
	    in a ::Rivet namespace that is called when the server starts up.

	* rivet/init.tcl
	    Added a command for cleanup after each request.  It currently
	    does nothing but could come in handy later.

	* rivet/packages
	    Created a rivet/packages directory for future Rivet packages.

	* rivet/rivet-tcl
	    Created a rivet/rivet-tcl directory containing a few procs.

	* rivet/rivet-tcl/load_response.tcl
	    Added 'load_response' command to rivet-tcl/.

	* rivet/rivet-tcl/parray.tcl
	    Added 'parray' command to rivet-tcl/.

2002-01-07  David N. Welton  <davidw@dedasys.com>

	* General: Renamed some more commands so that Rivet may be run
	alongside mod_dtcl.

	* src/mod_rivet.c (get_parse_exec_file): Oops - change httpd-tcl
	to httpd-rivet in strcmp.

2002-01-06  David N. Welton  <davidw@dedasys.com>

	* Documentation: Big cleanup, updating everything from mod_dtcl.

	* General: Changed .ttml to .rvt.  Also changed mime type to
	x-httpd-rivet.  Changed all references in documentation to .rvt
	from .ttml.

2002-01-05  David N. Welton  <davidw@dedasys.com>

	* src/parser.c (Rivet_Parser): A few, mostly cosmetic, cleanups in
	the parser.

	* src/make.tcl: Add nodes for testing library.

	* src/channel.c (outputproc): Change printheaders to
	Rivet_PrintHeaders.

	* General: whitespace cleanups.

2001-11-21  David N. Welton  <davidw@dedasys.com>

	* src/channel.c: Almost all output is based on the ApacheChan
	channel, and uses Tcl's buffering, flushing, etc...

	* tests/rivet.test: Updated testing scheme to work with lots of
	test files/ttml files.

2001-11-21  Damon J. Courtney <damon@unreality.com>

	* src/mod_rivet.c
	    Renamed more commands into the Rivet_ naming scheme.

2001-11-20  Damon J. Courtney <damon@unreality.com>

	* src/tcl_commands.c
	    load_env and load_cookies now accept an optional argument of
	    ?arrayName?.
	* src/tcl_commands.c
	    Renamed a lot of the commands into a standard naming scheme.

2001-11-20  Damon J. Courtney <damon@unreality.com>

	* src/tcl_commands.c
	    Cleaned up some more code.  Just textual changes.
	* src/mod_rivet.c
	    Cleaned up some run-over lines and code.
	* src/mod_rivet.c
	    Changed module signature from "mod_rivet" to "Rivet"
	* src/tcl_commands.c
	    Changed hgetvars command to load_env command.
	* src/tcl_command.c
	    Moved loading of cookies to load_cookies command.
	* src/tcl_command.c
	    Renamed default load_env array from ENVS array to env.
	* src/tcl_command.c
	    Renamed default load_cookies array from COOKIES to cookies.

2001-11-08  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (rivet_child_init): Fix loop, pass correct
	parameter to RIVET_SERVER_CONF.

2001-10-19  David N. Welton  <davidw@dedasys.com>

	* src/mod_rivet.c (get_parse_exec_file): Fixed up problems with
	Parse command.

2001-09-30  David N. Welton  <davidw@dedasys.com>

	* src/parser.c (rivet_parser): Quote { and } to avoid problems.

2001-09-23  David N. Welton  <davidw@dedasys.com>

	* Initial commit and cleanup of old mod_dtcl code.
